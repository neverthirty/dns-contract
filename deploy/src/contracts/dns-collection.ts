import TonWeb from "tonweb";
import { DictBuilder, Address, Builder, Cell } from "ton";
import { DNS_ITEM_CODE_HEX } from "./dns-item";

class TonWebCell extends TonWeb["boc"]["Cell"] {}

const DNS_COLLECTION_CODE_HEX = "B5EE9C7241021E01000315000114FF00F4A413F4BCF2C80B0102016202030202CC040502012016170201200607020120121302012008090201200C0D0281420C70094840FF2F0DE01D0D3030171B0925F03E0FA403001D31FED44D0FA40D4D4D430303123C00024C001B1E302303133318210370FEC51BAE30230840FF2F080A0B00335709F01D30701C00020B39402A60802DE12E63120C000F2D0C9800FC03C00120975114C705F2E1959131E2F8232082106300A290BC22B1F2E0C702F00420D74920C200F2E0C8208100C0BBF2E0C92078A908C000F2E0CA21F005F2E0CB5003F00715BE24B1F2E0CC20F9018051F833206EB38E10D0F4043052108307F40E6FA131F2D0CD9130E2C858CF16C9C85004CF1613CC13CA00C912F00C0086F8276F108210B2D05E00A120C2008E308210370FEC51F8256D70708010C8CB055007CF165005FA0215CB6A12CB1FCB3F226EB39458CF17019132E201C901FB00915BE20201200E0F0201201011004F3223880875D244B5C61673C58875D2883000082CE6C070007CB83280B50C3400A44C78B98C72742000611C0875D26389972E882CE387CC00B4C1C8708BC8B04EAC08B09800F05EC4EC04AC6CC82CE500A98200B784F7B99B04AEA0005708300065CC2042EDE0404AF8083000A58C2040F9E018F8083000E58C20403E600678300124E00C5D781E9C600069006AC0BC018060840EE6B2802A0060840EE6B2802A00A08418C028A428608209E3402A410830856456F81B04A5A9D6A0192A41392002015814150039D2CF8053810F805BBC00C646582AC678B387D0165B5E66664C0207D804002D007232FFFE0A33C5B25C083232C044FD003D0032C03260001B3E401D3232C084B281F2FFF2742002012018190201201C1D0007B8B5D3180201201A1B002BB5DAFDA89A1F481A9A9A860D863A1A61FA61FF4806100029B4F47DA89A1F481A9A9A86026BE07E014E003E0170001DB905BED44D0FA40D4D4D4305B7F028009DBA30C3020D74978A908C000F2E04620D70A07C00021D749C0085210B0935B786DE0209501D3073101DE21F0035122D71830F9018200BA93C8CB0F01820167A3ED43D8CF16C90191789170E212A0018289375CE";

class DnsCollection extends TonWeb["Contract"] {
    constructor(provider, options) {
        options.code = TonWebCell.oneFromBoc(DNS_COLLECTION_CODE_HEX);
        super(provider, options);
    }

    public createDataCell(): any {
        const b = new Builder();
        b.storeAddress(Address.parse((this.options as any).ownerAddress));
        b.storeRef((new Builder()).storeUint(1, 8).storeBuffer(Buffer.from((this.options as any).infoUrl)).endCell());
        b.storeRef(Cell.fromBoc(Buffer.from(DNS_ITEM_CODE_HEX, "hex"))[0]);
        b.storeRef(this.createRoyaltyCell());
        return TonWebCell.fromBoc(b.endCell().toBoc().toString("hex"))[0];
    }

    private createRoyaltyCell(): Cell {
        const royaltyCell = new Builder();
        royaltyCell.storeUint(40, 16);
        royaltyCell.storeUint(1000, 16);
        royaltyCell.storeAddress(Address.parse((this.options as any).ownerAddress));
        return royaltyCell.endCell();
    }

    public createMintBody(domain: string, withAuction: boolean): any {
        const b = new Builder();
        b.storeUint(withAuction ? 0: 1, 32);
        b.storeBuffer(Buffer.from(domain, "ascii"))

        return TonWebCell.fromBoc(b.endCell().toBoc().toString("hex"))[0];
    }

    public createFillUpBody(): any {
        const b = new Builder();
        b.storeUint(0x370fec51, 32);
        b.storeRef((new Builder().endCell()));

        return TonWebCell.fromBoc(b.endCell().toBoc().toString("hex"))[0];
    }
}

export { DnsCollection, DNS_COLLECTION_CODE_HEX }